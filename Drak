--[[ 
    ACTIVE SCRIPT EXPLORER - QUÉT SCRIPT ĐANG CHẠY
    Chức năng: Hiện danh sách toàn bộ script để bạn tự chọn và copy
]]

-- 1. HÀM TẠO GIAO DIỆN
local function CreateGUI()
    local CoreGui = game:GetService("CoreGui")
    local ScreenGui = Instance.new("ScreenGui")
    local MainFrame = Instance.new("Frame")
    local Title = Instance.new("TextLabel")
    local Scroll = Instance.new("ScrollingFrame")
    local CloseBtn = Instance.new("TextButton")
    local ScanBtn = Instance.new("TextButton")
    local UIList = Instance.new("UIListLayout")
    
    ScreenGui.Name = "ScriptExplorer"
    if gethui then
        ScreenGui.Parent = gethui()
    else
        ScreenGui.Parent = CoreGui
    end

    -- Khung chính
    MainFrame.Name = "MainFrame"
    MainFrame.Parent = ScreenGui
    MainFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
    MainFrame.Position = UDim2.new(0.5, -175, 0.2, 0)
    MainFrame.Size = UDim2.new(0, 350, 0, 400)
    MainFrame.BorderSizePixel = 2
    MainFrame.BorderColor3 = Color3.fromRGB(0, 255, 255)
    MainFrame.Active = true
    MainFrame.Draggable = true

    -- Tiêu đề
    Title.Parent = MainFrame
    Title.BackgroundColor3 = Color3.fromRGB(0, 150, 255)
    Title.Size = UDim2.new(1, 0, 0, 40)
    Title.Font = Enum.Font.SourceSansBold
    Title.Text = "  DANH SÁCH SCRIPT ĐANG CHẠY"
    Title.TextColor3 = Color3.new(1, 1, 1)
    Title.TextSize = 16
    Title.TextXAlignment = Enum.TextXAlignment.Left

    -- Nút Đóng
    CloseBtn.Parent = MainFrame
    CloseBtn.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
    CloseBtn.Position = UDim2.new(1, -40, 0, 0)
    CloseBtn.Size = UDim2.new(0, 40, 0, 40)
    CloseBtn.Font = Enum.Font.SourceSansBold
    CloseBtn.Text = "X"
    CloseBtn.TextColor3 = Color3.new(1,1,1)
    CloseBtn.TextSize = 18
    CloseBtn.MouseButton1Click:Connect(function() ScreenGui:Destroy() end)

    -- Khung cuộn danh sách
    Scroll.Parent = MainFrame
    Scroll.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
    Scroll.Position = UDim2.new(0, 10, 0, 50)
    Scroll.Size = UDim2.new(1, -20, 1, -100)
    Scroll.CanvasSize = UDim2.new(0, 0, 0, 0)
    Scroll.ScrollBarThickness = 4

    UIList.Parent = Scroll
    UIList.SortOrder = Enum.SortOrder.LayoutOrder
    UIList.Padding = UDim.new(0, 5)

    -- Nút Quét Lại
    ScanBtn.Parent = MainFrame
    ScanBtn.BackgroundColor3 = Color3.fromRGB(0, 200, 100)
    ScanBtn.Position = UDim2.new(0, 10, 1, -40)
    ScanBtn.Size = UDim2.new(1, -20, 0, 30)
    ScanBtn.Font = Enum.Font.SourceSansBold
    ScanBtn.Text = "QUÉT LẠI (REFRESH)"
    ScanBtn.TextColor3 = Color3.new(1,1,1)
    ScanBtn.TextSize = 14

    return ScreenGui, Scroll, ScanBtn
end

-- 2. HÀM TẠO NÚT CHO MỖI SCRIPT
local function AddScriptButton(scroll, scriptObj)
    local btn = Instance.new("TextButton")
    btn.Parent = scroll
    btn.Size = UDim2.new(1, 0, 0, 40)
    btn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    btn.Text = "  " .. scriptObj.Name .. "\n  (" .. scriptObj.ClassName .. ")"
    btn.TextColor3 = Color3.fromRGB(200, 200, 200)
    btn.Font = Enum.Font.Code
    btn.TextSize = 12
    btn.TextXAlignment = Enum.TextXAlignment.Left
    
    -- Khi bấm vào script
    btn.MouseButton1Click:Connect(function()
        if not decompile then
            btn.Text = "  LỖI: KHÔNG HỖ TRỢ DECOMPILE"
            btn.TextColor3 = Color3.new(1,0,0)
            return
        end
        
        btn.Text = "  ⏳ ĐANG GIẢI MÃ..."
        btn.BackgroundColor3 = Color3.fromRGB(200, 150, 0)
        
        spawn(function()
            local success, code = pcall(function() return decompile(scriptObj) end)
            if success then
                setclipboard(code)
                btn.Text = "  ✅ ĐÃ COPY CODE! (Dán ngay)"
                btn.BackgroundColor3 = Color3.fromRGB(0, 150, 0)
                btn.TextColor3 = Color3.new(1,1,1)
                wait(2)
                btn.Text = "  " .. scriptObj.Name .. "\n  (" .. scriptObj.ClassName .. ")"
                btn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
                btn.TextColor3 = Color3.fromRGB(200, 200, 200)
            else
                btn.Text = "  ❌ KHÔNG THỂ ĐỌC (Bị khóa)"
                btn.BackgroundColor3 = Color3.fromRGB(150, 0, 0)
            end
        end)
    end)
end

-- 3. LOGIC QUÉT CHÍNH
local GUI, ScrollContainer, ScanButton = CreateGUI()

local function ScanScripts()
    -- Xóa danh sách cũ
    for _, v in pairs(ScrollContainer:GetChildren()) do
        if v:IsA("TextButton") then v:Destroy() end
    end
    
    local count = 0
    
    -- Quét CoreGui (Nơi chứa Hub)
    for _, v in pairs(game:GetService("CoreGui"):GetDescendants()) do
        if (v:IsA("LocalScript") or v:IsA("ModuleScript")) then
            -- Lọc bớt script rác của Roblox (tên thường chứa 'Roblox' hoặc 'Core')
            -- Nhưng nếu bạn muốn tìm kỹ thì bỏ lọc cũng được. Ở đây tôi lọc nhẹ.
            if not string.find(v.Name, "Roblox") then
                AddScriptButton(ScrollContainer, v)
                count = count + 1
            end
        end
    end
    
    -- Quét Player
    for _, v in pairs(game.Players.LocalPlayer:GetDescendants()) do
        if (v:IsA("LocalScript") or v:IsA("ModuleScript")) then
            AddScriptButton(ScrollContainer, v)
            count = count + 1
        end
    end
    
    -- Cập nhật độ dài danh sách cuộn
    ScrollContainer.CanvasSize = UDim2.new(0, 0, 0, count * 45)
end

ScanButton.MouseButton1Click:Connect(ScanScripts)

-- Tự động quét lần đầu
ScanScripts()
