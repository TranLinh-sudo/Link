--[[ 
    DATA MINER V5 - UPVALUE SCANNER (QUÉT SÂU)
    Chức năng: Móc túi các hàm (Function) để tìm dữ liệu bị giấu.
]]

local HttpService = game:GetService("HttpService")
local RunService = game:GetService("RunService")
local FileName = "TEDDY_DEEP_DATA.txt"

-- GIAO DIỆN
local ScreenGui = Instance.new("ScreenGui")
local MainFrame = Instance.new("Frame")
local Title = Instance.new("TextLabel")
local StatusLabel = Instance.new("TextLabel")
local CloseBtn = Instance.new("TextButton")

if gethui then ScreenGui.Parent = gethui() else ScreenGui.Parent = game.CoreGui end
ScreenGui.Name = "DeepMiner"

MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3.fromRGB(40, 0, 60) -- Màu tím đậm
MainFrame.Position = UDim2.new(0.5, -150, 0.1, 0)
MainFrame.Size = UDim2.new(0, 300, 0, 120)
MainFrame.BorderSizePixel = 2
MainFrame.BorderColor3 = Color3.fromRGB(255, 0, 255)

Title.Parent = MainFrame
Title.Size = UDim2.new(1, 0, 0, 30)
Title.BackgroundColor3 = Color3.fromRGB(100, 0, 150)
Title.Text = "QUÉT SÂU (UPVALUES)"
Title.TextColor3 = Color3.new(1,1,1)
Title.Font = Enum.Font.SourceSansBold
Title.TextSize = 16

StatusLabel.Parent = MainFrame
StatusLabel.Position = UDim2.new(0, 10, 0, 40)
StatusLabel.Size = UDim2.new(1, -20, 0, 40)
StatusLabel.BackgroundTransparency = 1
StatusLabel.Text = "Đang lục soát các hàm..."
StatusLabel.TextColor3 = Color3.fromRGB(255, 200, 255)
StatusLabel.TextWrapped = true
StatusLabel.Font = Enum.Font.Code
StatusLabel.TextSize = 13

CloseBtn.Parent = MainFrame
CloseBtn.Position = UDim2.new(0, 0, 1, -30)
CloseBtn.Size = UDim2.new(1, 0, 0, 30)
CloseBtn.BackgroundColor3 = Color3.fromRGB(150, 0, 50)
CloseBtn.Text = "ĐÓNG"
CloseBtn.TextColor3 = Color3.new(1,1,1)
CloseBtn.MouseButton1Click:Connect(function() ScreenGui:Destroy() end)

-- HÀM KIỂM TRA DỮ LIỆU
local function IsTarget(val)
    if type(val) == "string" then
        -- Tìm các từ khóa cứng
        if string.find(val, "Bandit") or string.find(val, "Quest") or string.find(val, "Tushita") or string.find(val, "CFrame") then
            return true
        end
    elseif type(val) == "table" then
        -- Nếu là bảng, kiểm tra bên trong bảng
        for k, v in pairs(val) do
            if type(v) == "string" and (string.find(v, "Bandit") or string.find(v, "Quest")) then
                return true
            end
            -- Nếu key là tên biến quan trọng
            if tostring(k) == "Mon" or tostring(k) == "CFrameQuest" then
                return true
            end
        end
    end
    return false
end

-- HÀM LÀM SẠCH
local function Clean(v)
    if typeof(v) == "CFrame" then return tostring(v)
    elseif typeof(v) == "Vector3" then return tostring(v)
    elseif type(v) == "table" then return "{Table...}"
    else return tostring(v) end
end

task.spawn(function()
    if not debug.getupvalues or not getgc then
        StatusLabel.Text = "LỖI: Executor không hỗ trợ debug.getupvalues!"
        return
    end

    local Output = "=== DỮ LIỆU TÌM ĐƯỢC TỪ UPVALUES ===\n\n"
    local FoundCount = 0
    local Scanned = 0
    
    -- Lấy tất cả đối tượng
    local gcObjects = getgc()
    local total = #gcObjects
    
    for i, func in pairs(gcObjects) do
        Scanned = Scanned + 1
        if Scanned % 500 == 0 then
            StatusLabel.Text = "Đang soi: " .. Scanned .. " / " .. total .. "\n(Hàm chức năng)"
            RunService.Heartbeat:Wait()
        end

        -- Chỉ kiểm tra nếu nó là Hàm (Function) và là Lua Script (không phải C++)
        if type(func) == "function" and islclosure(func) and not is_synapse_function(func) then
            local upvalues = debug.getupvalues(func)
            
            for k, val in pairs(upvalues) do
                if IsTarget(val) then
                    FoundCount = FoundCount + 1
                    
                    -- Lưu lại
                    Output = Output .. "--- [TÌM THẤY TRONG HÀM #" .. i .. "] ---\n"
                    
                    if type(val) == "table" then
                        Output = Output .. "Loại: TABLE\n"
                        for subK, subV in pairs(val) do
                            pcall(function()
                                Output = Output .. "   [" .. tostring(subK) .. "] = " .. Clean(subV) .. "\n"
                            end)
                        end
                    else
                        Output = Output .. "Giá trị: " .. Clean(val) .. "\n"
                    end
                    Output = Output .. "\n"
                end
            end
        end
    end
    
    if FoundCount > 0 then
        writefile(FileName, Output)
        StatusLabel.Text = "✅ XONG! Tìm thấy " .. FoundCount .. " dữ liệu ẩn.\nĐã lưu file: " .. FileName
        MainFrame.BorderColor3 = Color3.new(0,1,0)
    else
        StatusLabel.Text = "⚠️ VẪN KHÔNG THẤY!\nScript này giấu quá kỹ."
        MainFrame.BorderColor3 = Color3.new(1,0,0)
    end
end)
