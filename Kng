--[[ 
    DATA MINER V5.5 - TURBO MODE
    Chức năng: Quét siêu nhanh, hiển thị số nhảy liên tục, không bao giờ đứng hình.
]]

local FileName = "TEDDY_DEEP_DATA.txt"
local RunService = game:GetService("RunService")

-- 1. GIAO DIỆN ĐƠN GIẢN HÓA (ĐỂ ĐỠ LAG)
local ScreenGui = Instance.new("ScreenGui")
local Frame = Instance.new("Frame")
local Title = Instance.new("TextLabel")
local Status = Instance.new("TextLabel")
local CountLabel = Instance.new("TextLabel")

if gethui then ScreenGui.Parent = gethui() else ScreenGui.Parent = game.CoreGui end
ScreenGui.Name = "MinerV5_5"

Frame.Parent = ScreenGui
Frame.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
Frame.Position = UDim2.new(0.5, -125, 0.1, 0)
Frame.Size = UDim2.new(0, 250, 0, 100)
Frame.BorderSizePixel = 2
Frame.BorderColor3 = Color3.fromRGB(255, 255, 0) -- Viền vàng

Title.Parent = Frame
Title.Size = UDim2.new(1, 0, 0, 30)
Title.BackgroundTransparency = 1
Title.Text = "⚡ TURBO SCANNER ⚡"
Title.TextColor3 = Color3.new(1, 1, 0)
Title.Font = Enum.Font.SourceSansBold
Title.TextSize = 18

Status.Parent = Frame
Status.Position = UDim2.new(0, 0, 0, 35)
Status.Size = UDim2.new(1, 0, 0, 25)
Status.BackgroundTransparency = 1
Status.Text = "Đang khởi động..."
Status.TextColor3 = Color3.new(1,1,1)
Status.TextSize = 14

CountLabel.Parent = Frame
CountLabel.Position = UDim2.new(0, 0, 0, 60)
CountLabel.Size = UDim2.new(1, 0, 0, 30)
CountLabel.BackgroundTransparency = 1
CountLabel.Text = "0 / 0"
CountLabel.TextColor3 = Color3.fromRGB(0, 255, 255) -- Xanh dương
CountLabel.Font = Enum.Font.Code
CountLabel.TextSize = 16

-- 2. HÀM LÀM SẠCH DỮ LIỆU
local function Clean(v)
    if typeof(v) == "CFrame" then 
        return string.format("Pos(%.0f,%.0f,%.0f)", v.Position.X, v.Position.Y, v.Position.Z)
    elseif typeof(v) == "Vector3" then 
        return string.format("Vec3(%.0f,%.0f,%.0f)", v.X, v.Y, v.Z)
    elseif type(v) == "table" then 
        return "{Table}"
    else 
        return tostring(v) 
    end
end

-- 3. HÀM TÌM KIẾM (TARGET)
local function IsTarget(val)
    if type(val) == "string" then
        if string.find(val, "Bandit") or string.find(val, "Quest") or string.find(val, "Tushita") or string.find(val, "GodHuman") then
            return true
        end
    elseif type(val) == "table" then
        for k, v in pairs(val) do
            if tostring(k) == "Mon" or tostring(k) == "CFrameQuest" then return true end
        end
    end
    return false
end

-- 4. LOGIC QUÉT (CHẠY TRONG THREAD RIÊNG)
task.spawn(function()
    if not getgc then
        Status.Text = "LỖI: Executor yếu!"
        return
    end

    Status.Text = "Đang tải dữ liệu RAM..."
    RunService.Heartbeat:Wait()

    -- Lấy danh sách (Bước này có thể khựng 1 chút)
    local gcObjects = getgc() 
    local total = #gcObjects
    local output = "=== DỮ LIỆU QUÉT ĐƯỢC ===\n\n"
    local found = 0
    local scanned = 0
    
    Status.Text = "Đang quét tốc độ cao..."

    for i, v in pairs(gcObjects) do
        scanned = scanned + 1
        
        -- Cập nhật giao diện mỗi 200 item (Để thấy số nhảy liên tục)
        if scanned % 200 == 0 then
            CountLabel.Text = scanned .. " / " .. total
            RunService.Heartbeat:Wait() -- Nghỉ cực ngắn để UI không bị đơ
        end

        -- Bọc trong pcall để nếu lỗi 1 cái thì không chết cả tool
        pcall(function()
            if type(v) == "function" and islclosure(v) and not is_synapse_function(v) then
                local upvalues = debug.getupvalues(v)
                for k, val in pairs(upvalues) do
                    if IsTarget(val) then
                        found = found + 1
                        output = output .. "-- [HÀM #" .. i .. "]\n"
                        if type(val) == "table" then
                            for subK, subV in pairs(val) do
                                output = output .. "   " .. tostring(subK) .. ": " .. Clean(subV) .. "\n"
                            end
                        else
                            output = output .. "   Val: " .. Clean(val) .. "\n"
                        end
                        output = output .. "\n"
                    end
                end
            end
        end)
    end
    
    if found > 0 then
        writefile(FileName, output)
        Status.Text = "✅ HOÀN TẤT!"
        Status.TextColor3 = Color3.new(0,1,0)
        CountLabel.Text = "Tìm thấy: " .. found .. " dữ liệu"
        Frame.BorderColor3 = Color3.new(0,1,0)
        
        -- Nút Đóng
        local close = Instance.new("TextButton", Frame)
        close.Size = UDim2.new(1,0,1,0)
        close.BackgroundTransparency = 1
        close.Text = ""
        close.MouseButton1Click:Connect(function() ScreenGui:Destroy() end)
    else
        Status.Text = "⚠️ KHÔNG TÌM THẤY!"
        Status.TextColor3 = Color3.new(1,0,0)
        CountLabel.Text = "Hãy chắc chắn Teddy Hub đang chạy."
        wait(5)
        ScreenGui:Destroy()
    end
end)
