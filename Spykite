--[[ 
    UI SCANNER V2 - XUYÊN THẤU (X-RAY)
    Chức năng: Quét mọi ngóc ngách (kể cả gethui) để tìm giao diện ẩn
]]

local FileName = "TEDDY_UI_MAP_FULL.txt"
local Output = "=== DANH SÁCH GIAO DIỆN TÌM THẤY ===\n" .. "Time: " .. os.date("%X") .. "\n\n"

game:GetService("StarterGui"):SetCore("SendNotification", {
    Title = "ĐANG BẬT X-RAY...",
    Text = "Đang quét sâu vào hệ thống...",
    Duration = 3
})

-- Hàm ghi chép
local function LogUI(gui, location)
    Output = Output .. "------------------------------------------------\n"
    Output = Output .. "[VỊ TRÍ]: " .. location .. "\n"
    Output = Output .. "[TÊN GUI]: " .. gui.Name .. " (" .. gui.ClassName .. ")\n"
    
    -- Đếm sơ bộ nội dung bên trong
    local btnCount = 0
    local frameCount = 0
    for _, v in pairs(gui:GetDescendants()) do
        if v:IsA("TextButton") or v:IsA("ImageButton") then btnCount = btnCount + 1 end
        if v:IsA("Frame") or v:IsA("ScrollingFrame") then frameCount = frameCount + 1 end
    end
    
    Output = Output .. "   + Số nút bấm: " .. btnCount .. "\n"
    Output = Output .. "   + Số khung hình: " .. frameCount .. "\n"
    
    -- Nếu có nút, liệt kê ra vài cái để nhận diện
    if btnCount > 0 then
        Output = Output .. "   + Mẫu nút tìm thấy:\n"
        local count = 0
        for _, v in pairs(gui:GetDescendants()) do
            if v:IsA("TextButton") and v.Text ~= "" then
                count = count + 1
                Output = Output .. "      - " .. v.Name .. ": \"" .. v.Text .. "\"\n"
                if count >= 5 then break end -- Chỉ hiện 5 cái đầu
            end
        end
    end
    Output = Output .. "\n"
    return true
end

task.spawn(function()
    local FoundCount = 0
    
    -- 1. QUÉT TRONG GETHUI (Nơi ẩn náu cao cấp)
    if gethui then
        for _, v in pairs(gethui():GetChildren()) do
            if v:IsA("ScreenGui") then
                LogUI(v, "Secret Folder (gethui)")
                FoundCount = FoundCount + 1
            end
        end
    end
    
    -- 2. QUÉT TRONG COREGUI (Nơi ẩn náu thường)
    for _, v in pairs(game:GetService("CoreGui"):GetChildren()) do
        if v:IsA("ScreenGui") and not string.find(v.Name, "Roblox") and not string.find(v.Name, "CoreScripts") then
            LogUI(v, "CoreGui")
            FoundCount = FoundCount + 1
        end
    end
    
    -- 3. QUÉT TRONG PLAYERGUI (Nơi công khai)
    for _, v in pairs(game.Players.LocalPlayer:WaitForChild("PlayerGui"):GetChildren()) do
        if v:IsA("ScreenGui") and v.Name ~= "Chat" and v.Name ~= "BubbleChat" and v.Name ~= "Freecam" then
            LogUI(v, "PlayerGui")
            FoundCount = FoundCount + 1
        end
    end
    
    -- KẾT QUẢ
    if FoundCount > 0 then
        writefile(FileName, Output)
        setclipboard(Output)
        
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = "QUÉT XONG!",
            Text = "Tìm thấy " .. FoundCount .. " giao diện.\nĐã lưu vào file và Copy.",
            Duration = 10
        })
    else
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = "VẪN KHÔNG THẤY?",
            Text = "Lạ thật! Hãy chắc chắn Teddy Hub đang hiện trên màn hình.",
            Duration = 5
        })
    end
end)
