--[[ 
    UI TREE SCANNER - QUÉT CẤU TRÚC MENU
    Chức năng: Vẽ lại bản đồ giao diện (Tab -> Mục -> Nút) ra file .txt
]]

local FileName = "TEDDY_UI_STRUCTURE.txt"
local CoreGui = game:GetService("CoreGui")
local PlayerGui = game.Players.LocalPlayer:WaitForChild("PlayerGui")

game:GetService("StarterGui"):SetCore("SendNotification", {
    Title = "ĐANG QUÉT UI...",
    Text = "Vui lòng đợi giây lát...",
    Duration = 3
})

-- Hàm tạo khoảng trắng (để thụt đầu dòng cho đẹp)
local function Indent(count)
    return string.rep("   |", count) .. "-- "
end

local Output = "=== BẢN ĐỒ GIAO DIỆN SCRIPT ===\n"
Output = Output .. "Time: " .. os.date("%X") .. "\n\n"

-- Hàm đệ quy: Quét sâu vào bên trong từng Frame
local function ScanObject(obj, depth)
    local info = Indent(depth) .. "[" .. obj.ClassName .. "] " .. obj.Name
    
    -- Nếu là nút hoặc nhãn, lấy thêm nội dung chữ
    if obj:IsA("TextButton") or obj:IsA("TextLabel") or obj:IsA("TextBox") then
        if obj.Text ~= "" then
            info = info .. "  (Text: \"" .. obj.Text .. "\")"
        end
    end
    
    Output = Output .. info .. "\n"
    
    -- Quét tiếp con cái bên trong
    for _, child in pairs(obj:GetChildren()) do
        -- Lọc bớt các thành phần trang trí không cần thiết (UICorner, UIListLayout...)
        if not child:IsA("UIBase") and not child:IsA("LocalScript") then 
            ScanObject(child, depth + 1)
        end
    end
end

task.spawn(function()
    local Found = false
    
    -- 1. Quét trong CoreGui (Nơi Hub thường ẩn nấp)
    for _, v in pairs(CoreGui:GetDescendants()) do
        -- Tìm ScreenGui nào KHÔNG PHẢI của Roblox
        if v:IsA("ScreenGui") and v.Enabled then
            if not string.find(v.Name, "Roblox") and not string.find(v.Name, "CoreScripts") and not string.find(v.Name, "TopBar") then
                
                -- Chỉ quét nếu nó có vẻ là một cái Menu (Có Frame con)
                if #v:GetChildren() > 0 then
                    Output = Output .. "==========================================\n"
                    Output = Output .. "PHÁT HIỆN MENU: " .. v.Name .. "\n"
                    Output = Output .. "==========================================\n"
                    ScanObject(v, 0)
                    Found = true
                end
            end
        end
    end
    
    -- 2. Quét trong PlayerGui (Đề phòng Hub lởm)
    for _, v in pairs(PlayerGui:GetChildren()) do
        if v:IsA("ScreenGui") and v.Name ~= "Chat" and v.Name ~= "BubbleChat" and v.Name ~= "Freecam" then
             -- Kiểm tra sơ bộ xem có phải Hub không (thường Hub sẽ có nhiều nút)
             local btnCount = 0
             for _, b in pairs(v:GetDescendants()) do if b:IsA("TextButton") then btnCount = btnCount + 1 end end
             
             if btnCount > 5 then -- Nếu có trên 5 nút thì nghi là Hub
                Output = Output .. "\n[PlayerGui] MENU NGHI VẤN: " .. v.Name .. "\n"
                ScanObject(v, 0)
                Found = true
             end
        end
    end

    -- KẾT QUẢ
    if Found then
        writefile(FileName, Output)
        
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = "QUÉT XONG!",
            Text = "Đã lưu bản đồ giao diện vào file: " .. FileName,
            Duration = 10
        })
        
        -- Copy vào bộ nhớ tạm luôn
        setclipboard(Output)
    else
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = "KHÔNG TÌM THẤY",
            Text = "Không thấy giao diện nào khả nghi.",
            Duration = 5
        })
    end
end)
